<div ng-controller="ProjectController" flex>
  <main style="overflow:auto">
    <div flex>
      <md-content layout-wrap>
        <md-tabs md-dynamic-height md-border-bottom md-selected="tabdata.selectedIndex">
          <md-tab md-on-select="selectedProject(project)" ng-repeat="project in projectList" label="{{(project.name&&project.name!=='')?project.name:project.tree.item.name}}"></md-tab>
        </md-tabs>
          <!--<md-content layout="row" layout-wrap ng-if="projectData[project._id] && tabdata.selectedIndex==$index">-->
        <md-content layout="row" layout-xs="column" layout-sm="column" layout-fill ng-if="project">
          <md-card flex="25" flex-xs="100" flex-sm="100">
            <md-toolbar class="md-hue-2">
              <div class="md-toolbar-tools">
                <span>Recipe Tree</span>
                <span flex></span>
                <md-menu>
                  <md-button class="md-icon-button" aria-label="More" ng-click="$mdOpenMenu()">
                    <md-icon class="material-icons">more_vert</md-icon>
                  </md-button>
                  <md-menu-content>
                    <md-menu-item><md-button ng-click="showAllSteps()">Show all children</md-button></md-menu-item>
                    <md-menu-item><md-button ng-click="hideAllSteps()">Hide all children</md-button></md-menu-item>
                    <md-menu-item><md-button ng-click="stepDeletion.enabled = !stepDeletion.enabled">{{stepDeletion.enabled?'Hide':'Show'}} step deleters</md-button></md-menu-item>
                  </md-menu-content>
                </md-menu>
              </div>
            </md-toolbar>
            <md-card-content>
              <project-step data-step="project.tree" update-step="updateStep" price-update='priceUpdate' step-deletion="stepDeletion" deleted-step="updateList" show-deleter="true"></project-step>
            </md-card-content>
          </md-card>

          <div layout="column" flex="25" flex-xs="100" flex-sm="100">
            <project-item-crafts></project-item-crafts>
            <project-item-gathers></project-item-gathers>
          </div>

          <project-item-stock flex="25" flex-xs="100" flex-sm="100"></project-item-stock>

          <span layout="column" flex="25" flex-xs="100" flex-sm="100">
            <revenue-card project="project" project-data="projectData[project._id]"></revenue-card>

            <md-card>
              <md-card-content layout="column">
                <span>Project created By {{project.creator.name}}</span>
                <md-switch ng-model="project.public" ng-change="updateProject(project)">{{project.public?'public':'non-public'}} project</md-switch>
                <md-switch ng-model="project.private" ng-change="updateProject(project)">
                  <md-tooltip>If this is set, only you can see this project</md-tooltip>
                  {{project.private?'private':'non-private'}} project
                </md-switch>

                <md-input-container>
                  <label>Projectname</label>
                  <input type="text" ng-model="project.name" ng-model-options="{debounce:300}" ng-change="updateProject(project)"/>
                </md-input-container>

                <md-button ng-click="deleteProject(project)" class="md-raised">Delete Project</md-button>

                <md-input-container>
                  <md-select ng-model="mergeSelection">
                    <md-option ng-value="mergeProject" placeholder="Select a project to merge with" ng-if="mergeProject!==project" ng-repeat="mergeProject in projectList">{{(mergeProject.name&&mergeProject.name!=='')?mergeProject.name:mergeProject.tree.item.name}}</md-option>
                  </md-select>
                </md-input-container>
                <md-button class="md-raised" ng-click="doMerge(project,mergeSelection)">Merge with selected Project</md-button>
              </md-card-content>
            </md-card>

            <md-card id="commentCard">
              <md-card-header>
                <md-card-header-text class="md-title">
                  Comment
                </md-card-header-text>
              </md-card-header>
              <md-card-content>
                {{project.comment}}
              </md-card-content>
            </md-card>

            <md-card>
              <md-card-header>
                <md-card-header-text class="md-title">
                  Notes
                </md-card-header-text>
              </md-card-header>
              <md-card-content layout="column">
                <md-input-container>
                  <textarea ng-change="updateProjectNotes(project)" ng-model-options="{debounce:300}" ng-model="project.notes"></textarea>
                </md-input-container>
              </md-card-content>
            </md-card>
          </span>
        </md-content>
      </md-content>
    </div>
  </main>
</div>

<style>
.stepList {
  padding:0.5em 0 0.5em 0.5em;
}

.step select {
  border:0;
}

.md-errors-spacer:empty { display: none; }
</style>
