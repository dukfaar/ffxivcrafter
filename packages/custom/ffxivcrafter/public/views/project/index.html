<div ng-controller="ProjectController" flex>
  <main style="overflow:auto">
    <div flex>
      <md-content layout-wrap>
        <md-tabs md-dynamic-height md-border-bottom>
          <md-tab ng-repeat="project in projectList" label="{{project.tree.item.name}}">
            <md-content layout="row" layout-wrap>
              <md-card>
                <md-card-content>
                  <project-step data-step="project.tree" update-step="updateStep" price-update='priceUpdate'></project-step>
                </md-card-content>
              </md-card>

              <md-card>
                <md-card-header>
                  <md-card-header-text class="md-title">
                    Itemstock
                  </md-card-header-text>
                </md-card-header>
                <md-card-content>
                  <md-list>
                    <md-input-container>
                      <label>Itemfilter</label>
                      <input ng-model="stockFilter"/>
                    </md-input-container>
                    <md-list-item ng-repeat="stockElement in toArray(project.stock) | filter: { item: { name: stockFilter } }" layout="row">
                      <span flex>{{stockElement.amount}} {{stockElement.item.name}}</span>
                      <md-button class="md-raised" ng-click="addToStock(project,stockElement.item,-stockElement.amount)">RemoveFromStock</md-button>
                    </md-list-item>
                  </md-list>
                </md-card-content>
              </md-card>

              <md-card>
                <md-card-header>
                  <md-card-header-text class="md-title">
                    Items to Gather
                  </md-card-header-text>
                </md-card-header>
                <md-card-content>
                  <md-list>
                    <md-input-container>
                      <label>Itemfilter</label>
                      <input ng-model="gatherFilter"/>
                    </md-input-container>
                    <md-list-item ng-repeat="gathers in toArray(projectData[project._id].gatherList) | filter: { item: { name: gatherFilter } }" ng-if="gathers.outstanding>0" layout="row">
                      <span flex>{{gathers.outstanding}} {{gathers.item.name}}</span>

                      <md-button class="md-raised" ng-click="addToStock(project,gathers.item,gathers.outstanding)">AddToStock</md-button>
                    </md-list-item>
                  </md-list>
                </md-card-content>
              </md-card>

              <md-card>
                <md-card-header>
                  <md-card-header-text class="md-title">
                    Craftable Items
                  </md-card-header-text>
                </md-card-header>
                <md-card-content>
                  <md-list>
                    <md-input-container>
                      <label>Itemfilter</label>
                      <input ng-model="craftableFilter"/>
                    </md-input-container>
                    <md-list-item ng-repeat="craftable in toArray(projectData[project._id].craftableSteps)  | filter: { step: { item: { name: craftableFilter } } }" layout="row">
                      <span flex>{{craftable.step.amount}} {{craftable.step.item.name}}</span>

                      <md-button class="md-raised" ng-click="addToStock(project,craftable.step.item,craftable.step.amount)">AddToStock</md-button>
                    </md-list-item>
                  </md-list>
                </md-card-content>
              </md-card>

              <span layout="column">
                <md-card>
                  <md-card-content layout="column">
                    <div layout="row">
                      <span flex>Expected Revenue: </span>
                      <span>{{(project.tree.item.price*project.tree.amount).toLocaleString()}}g</span>
                    </div>
                    <div layout="row" layout-fill>
                      <span flex>Total Cost: </span>
                      <span >{{projectData[project._id].totalCost.toLocaleString()}}g</span>
                    </div>
                    <div layout="row">
                      <span flex>Expected Profit: </span>
                      <span>{{(project.tree.item.price*project.tree.amount*0.95-projectData[project._id].totalCost).toLocaleString()}}g</span>
                    </div>
                  </md-card-content>
                </md-card>

                <md-card>
                  <md-card-content>
                    <span>Project created By {{project.creator.name}}</span>
                    <md-switch ng-model="project.public" ng-change="updateProject(project)">{{project.public?'public':'non-public'}} project</md-switch>

                    <md-button ng-click="deleteProject(project)" class="md-raised">Delete Project</md-button>
                  </md-card-content>
                </md-card>

                <md-card>
                  <md-card-header>
                    <md-card-header-text class="md-title">
                      Comment
                    </md-card-header-text>
                  </md-card-header>
                  <md-card-content>
                    {{project.comment}}
                  </md-card-content>
                </md-card>
              </span>

            </md-content>
          </md-tab>
        </md-tabs>
      </md-content>
    </div>
  </main>
</div>

<style>
.stepList {
  padding:0.5em 0 0.5em 0.5em;
}

.step select {
  border:0;
}
</style>
